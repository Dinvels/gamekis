<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–π–º–∞–π –º—è—á–∏–∫! - –ö–∏—Å!</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #000; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            font-family: 'Arial', sans-serif; 
            overflow: hidden; 
            touch-action: none; 
        }
        #gameContainer { 
            position: relative; 
            width: 100vw; 
            height: 100vh; 
            overflow: hidden; 
        }
        #gameCanvas { 
            display: block; 
            width: 100%; 
            height: 100%; 
        }
        #ui { 
            position: absolute; 
            top: 20px; 
            left: 20px; 
            color: white; 
            font-size: 24px; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8); 
            z-index: 10; 
        }
        #pauseBtn { 
            position: absolute; 
            top: 20px; 
            right: 20px; 
            background: rgba(255,255,255,0.2); 
            color: white; 
            border: 2px solid white; 
            border-radius: 10px; 
            padding: 10px 15px; 
            font-size: 18px; 
            cursor: pointer; 
            z-index: 20; 
        }
        #startScreen, #gameOver, #pauseScreen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            z-index: 100;
        }
        #gameOver, #pauseScreen { display: none; }
        .game-btn {
            margin: 15px;
            padding: 15px 30px;
            font-size: 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        #quitBtn { background: #ff6b6b; }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <button id="pauseBtn">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
        <div id="ui">üê± –°—á–µ—Ç: <span id="score">0</span></div>
        
        <div id="startScreen">
            <h1>–ü–æ–π–º–∞–π –º—è—á–∏–∫, –∫–∏—Å! üê±</h1>
            <button class="game-btn" onclick="startGame()">–ì–æ—Ç–æ–≤–∞, –∫–∏—Å? üòº</button>
        </div>
        
        <div id="pauseScreen">
            <h2>–ü–∞—É–∑–∞</h2>
            <button class="game-btn" onclick="resumeGame()">‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            <button class="game-btn" onclick="restartGame()">üîÑ –ó–∞–Ω–æ–≤–æ</button>
        </div>
        
        <div id="gameOver">
            <h2>–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê! üê±</h2>
            <p>–°—á–µ—Ç: <span id="finalScore">0</span></p>
            <button class="game-btn" onclick="restartGame()">üéÆ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            <button class="game-btn" id="quitBtn" onclick="closeGame()">üö™ –í—ã–π—Ç–∏</button>
        </div>
    </div>

    <script>
        // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const config = {
            LEVELS: {
                1: { speed: 7, bounces: 10 },
                2: { speed: 9, bounces: 15 },
                3: { speed: 11, bounces: 20 }
            }
        };

        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let canvas, ctx;
        let platform, balls = [];
        let score = 0, currentLevel = 1, gameOver = false, isPaused = false;
        let WIDTH, HEIGHT;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        }

        function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            setupCanvas();
            setupControls();
        }

        function setupCanvas() {
            WIDTH = window.innerWidth;
            HEIGHT = window.innerHeight;
            canvas.width = WIDTH;
            canvas.height = HEIGHT;
            
            window.addEventListener('resize', () => {
                WIDTH = window.innerWidth;
                HEIGHT = window.innerHeight;
                canvas.width = WIDTH;
                canvas.height = HEIGHT;
            });
        }

        function setupControls() {
            // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞
            window.addEventListener('keydown', (e) => {
                if (gameOver || isPaused) return;
                if (e.key === 'ArrowLeft') platform.x -= platform.speed;
                if (e.key === 'ArrowRight') platform.x += platform.speed;
                if (e.key === ' ') togglePause();
            });
            
            // –°–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            let touchStartX = 0;
            canvas.addEventListener('touchmove', (e) => {
                if (gameOver || isPaused) return;
                const touchX = e.touches[0].clientX;
                platform.x = Math.max(0, Math.min(WIDTH - platform.width, touchX - platform.width/2));
                e.preventDefault();
            });
            
            document.getElementById('pauseBtn').addEventListener('click', togglePause);
        }

        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            resetGame();
            requestAnimationFrame(gameLoop);
        }

        function resetGame() {
            platform = {
                width: Math.min(150, WIDTH * 0.2),
                height: Math.max(15, HEIGHT * 0.02),
                x: WIDTH/2 - 75,
                y: HEIGHT * 0.85,
                speed: WIDTH * 0.02,
                color: '#FFB6C1'
            };

            balls = [{
                x: WIDTH/2,
                y: HEIGHT/3,
                radius: Math.max(10, WIDTH * 0.02),
                dx: config.LEVELS[1].speed * (Math.random() > 0.5 ? 1 : -1),
                dy: config.LEVELS[1].speed,
                color: '#ADD8E6'
            }];

            score = 0;
            currentLevel = 1;
            gameOver = false;
            isPaused = false;
            updateUI();
        }

        function gameLoop() {
            if (!gameOver && !isPaused) {
                update();
                render();
                requestAnimationFrame(gameLoop);
            }
        }

        function update() {
            // –î–≤–∏–∂–µ–Ω–∏–µ –º—è—á–∞
            balls.forEach(ball => {
                ball.x += ball.dx;
                ball.y += ball.dy;

                // –û—Ç—Å–∫–æ–∫ –æ—Ç —Å—Ç–µ–Ω
                if (ball.x - ball.radius <= 0 || ball.x + ball.radius >= WIDTH) {
                    ball.dx = -ball.dx;
                }
                if (ball.y - ball.radius <= 0) {
                    ball.dy = -ball.dy;
                }

                // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π
                if (ball.y + ball.radius >= platform.y && 
                    ball.y <= platform.y + platform.height &&
                    ball.x >= platform.x && 
                    ball.x <= platform.x + platform.width) {
                    
                    ball.dy = -Math.abs(ball.dy);
                    score++;
                    updateUI();
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è
                    if (score >= config.LEVELS[currentLevel].bounces && currentLevel < 3) {
                        currentLevel++;
                        balls.forEach(b => {
                            b.dx *= 1.2;
                            b.dy *= 1.2;
                        });
                    }
                }

                // –ü—Ä–æ–∏–≥—Ä—ã—à
                if (ball.y > HEIGHT) {
                    gameOver = true;
                    document.getElementById('finalScore').textContent = score;
                    document.getElementById('gameOver').style.display = 'flex';
                }
            });
        }

        function render() {
            // –§–æ–Ω
            ctx.fillStyle = '#1e3799';
            ctx.fillRect(0, 0, WIDTH, HEIGHT);
            
            // –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞
            ctx.fillStyle = platform.color;
            ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            
            // –ú—è—á–∏
            balls.forEach(ball => {
                ctx.fillStyle = ball.color;
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function updateUI() {
            document.getElementById('score').textContent = score;
        }

        function togglePause() {
            isPaused = !isPaused;
            document.getElementById('pauseScreen').style.display = isPaused ? 'flex' : 'none';
        }

        function resumeGame() {
            isPaused = false;
            document.getElementById('pauseScreen').style.display = 'none';
            requestAnimationFrame(gameLoop);
        }

        function restartGame() {
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('pauseScreen').style.display = 'none';
            resetGame();
            requestAnimationFrame(gameLoop);
        }

        function closeGame() {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.close();
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = init;
    </script>
</body>
</html>
