<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–π–º–∞–π –º—è—á–∏–∫! - –ö–∏—Å!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
        
        #gameContainer {
            position: relative;
            border: 3px solid #fff;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            overflow: hidden;
            width: 800px;
            height: 600px;
        }
        
        #gameCanvas {
            display: block;
            background: linear-gradient(180deg, #0c2461, #1e3799);
            width: 100%;
            height: 100%;
        }
        
        #ui {
            position: absolute;
            top: 15px;
            left: 15px;
            color: white;
            font-size: 16px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            background: rgba(0,0,0,0.6);
            padding: 10px;
            border-radius: 10px;
            line-height: 1.4;
        }
        
        #gameOver {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            z-index: 100;
        }
        
        .game-btn {
            margin: 10px;
            padding: 12px 24px;
            font-size: 18px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        
        #quitBtn {
            background: #ff6b6b;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 800px) {
            #gameContainer {
                width: 100vw;
                height: 100vh;
                border: none;
                border-radius: 0;
            }
            
            #ui {
                font-size: 14px;
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div id="ui">
            <div>–°—á–µ—Ç: <span id="score">0</span></div>
            <div>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></div>
            <div>–û—Ç—Å–∫–æ–∫–∏: <span id="bounces">0/24</span></div>
            <div>–ú—è—á–∏: <span id="balls">1</span></div>
        </div>
        
        <div id="gameOver">
            <h2>–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê, –ö–ò–°! üê±</h2>
            <p>–í–∞—à —Å—á–µ—Ç: <span id="finalScore">0</span></p>
            <p>–î–æ—Å—Ç–∏–≥–Ω—É—Ç —É—Ä–æ–≤–µ–Ω—å: <span id="finalLevel">1</span></p>
            <button class="game-btn" onclick="restartGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            <button class="game-btn" id="quitBtn" onclick="closeGame()">–í—ã–π—Ç–∏</button>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã
        const config = {
            WIDTH: 800,
            HEIGHT: 600,
            LEVEL_SETTINGS: {
                1: { speed: 4.0, bouncesNeeded: 24 },
                2: { speed: 6.0, bouncesNeeded: 24 },
                3: { speed: 8.0, bouncesNeeded: 24 },
                4: { speed: 10.0, bouncesNeeded: 24 },
                5: { speed: 12.0, bouncesNeeded: 24 },
                6: { speed: 14.0, bouncesNeeded: 24 },
                7: { speed: 16.0, bouncesNeeded: 24 },
                8: { speed: 18.0, bouncesNeeded: 24 },
                9: { speed: 20.0, bouncesNeeded: 24 },
                10: { speed: 22.0, bouncesNeeded: 9999 }
            },
            POWERUP_CHANCE: 0.15
        };

        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let canvas, ctx;
        let platform, balls, powerups, activePowerups;
        let score = 0;
        let currentLevel = 1;
        let bouncesInCurrentLevel = 0;
        let gameOver = false;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            setupControls();
            
            // –°–±—Ä–æ—Å –∏–≥—Ä—ã
            resetGame();
            
            // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
            requestAnimationFrame(gameLoop);
        }

        function setupControls() {
            // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞
            window.addEventListener('keydown', (e) => {
                if (gameOver) return;
                
                if (e.key === 'ArrowLeft') {
                    platform.x = Math.max(0, platform.x - platform.speed);
                } else if (e.key === 'ArrowRight') {
                    platform.x = Math.min(config.WIDTH - platform.width, platform.x + platform.speed);
                }
            });
            
            // –°–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
            let touchStartX = 0;
            
            canvas.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                e.preventDefault();
            });
            
            canvas.addEventListener('touchmove', (e) => {
                if (gameOver) return;
                
                const touchX = e.touches[0].clientX;
                const rect = canvas.getBoundingClientRect();
                const gameX = (touchX - rect.left) * (config.WIDTH / rect.width);
                
                platform.x = Math.max(0, Math.min(config.WIDTH - platform.width, gameX - platform.width / 2));
                
                e.preventDefault();
            });
        }

        function resetGame() {
            platform = {
                width: 100,
                height: 20,
                x: config.WIDTH / 2 - 50,
                y: config.HEIGHT - 40,
                speed: 8
            };

            const angle = Math.random() * Math.PI/2 + Math.PI/4;
            const speed = config.LEVEL_SETTINGS[1].speed;
            
            balls = [{
                x: config.WIDTH / 2,
                y: config.HEIGHT / 3,
                radius: 15,
                dx: Math.cos(angle) * speed,
                dy: Math.sin(angle) * speed,
                color: '#ADD8E6'
            }];

            powerups = [];
            activePowerups = {};
            score = 0;
            currentLevel = 1;
            bouncesInCurrentLevel = 0;
            gameOver = false;

            updateUI();
        }

        function gameLoop() {
            if (!gameOver) {
                update();
                render();
                requestAnimationFrame(gameLoop);
            }
        }

        function update() {
            // –î–≤–∏–∂–µ–Ω–∏–µ –º—è—á–µ–π
            balls.forEach((ball, index) => {
                ball.x += ball.dx;
                ball.y += ball.dy;

                // –û—Ç—Å–∫–æ–∫ –æ—Ç —Å—Ç–µ–Ω
                if (ball.x - ball.radius <= 0 || ball.x + ball.radius >= config.WIDTH) {
                    ball.dx = -ball.dx;
                }

                if (ball.y - ball.radius <= 0) {
                    ball.dy = -ball.dy;
                }

                // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π
                if (ball.y + ball.radius >= platform.y && 
                    ball.y - ball.radius <= platform.y + platform.height &&
                    ball.x >= platform.x && 
                    ball.x <= platform.x + platform.width) {
                    
                    // –û—Ç—Å–∫–æ–∫
                    const hitPos = (ball.x - platform.x) / platform.width;
                    ball.dx = (hitPos - 0.5) * 10;
                    ball.dy = -Math.abs(ball.dy);
                    
                    // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç–∞
                    score++;
                    bouncesInCurrentLevel++;
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è
                    if (bouncesInCurrentLevel >= config.LEVEL_SETTINGS[currentLevel].bouncesNeeded) {
                        if (currentLevel < 10) {
                            currentLevel++;
                            bouncesInCurrentLevel = 0;
                            
                            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å
                            balls.forEach(b => {
                                const currentSpeed = Math.sqrt(b.dx * b.dx + b.dy * b.dy);
                                const newSpeed = config.LEVEL_SETTINGS[currentLevel].speed;
                                b.dx = (b.dx / currentSpeed) * newSpeed;
                                b.dy = (b.dy / currentSpeed) * newSpeed;
                            });
                        }
                    }
                    
                    // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
                    platform.width = 100 * (1 + 0.001 * score);
                    if (platform.x + platform.width > config.WIDTH) {
                        platform.x = config.WIDTH - platform.width;
                    }
                    
                    updateUI();
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–≥—Ä—ã—à–∞
                if (ball.y - ball.radius > config.HEIGHT) {
                    balls.splice(index, 1);
                }
            });

            // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã –µ—Å–ª–∏ –Ω–µ—Ç –º—è—á–µ–π
            if (balls.length === 0) {
                endGame();
            }
        }

        function render() {
            // –§–æ–Ω
            ctx.fillStyle = currentLevel >= 3 ? '#e55039' : '#1e3799';
            ctx.fillRect(0, 0, config.WIDTH, config.HEIGHT);

            // –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞
            ctx.fillStyle = '#FFB6C1';
            ctx.fillRect(platform.x, platform.y, platform.width, platform.height);

            // –ú—è—á–∏
            balls.forEach(ball => {
                ctx.fillStyle = ball.color;
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = currentLevel;
            document.getElementById('bounces').textContent = `${bouncesInCurrentLevel}/${config.LEVEL_SETTINGS[currentLevel].bouncesNeeded}`;
            document.getElementById('balls').textContent = balls.length;
        }

        function endGame() {
            gameOver = true;
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalLevel').textContent = currentLevel;
            document.getElementById('gameOver').style.display = 'flex';
        }

        function restartGame() {
            document.getElementById('gameOver').style.display = 'none';
            resetGame();
            requestAnimationFrame(gameLoop);
        }

        function closeGame() {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.close();
            }
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = init;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        }
    </script>
</body>
</html>
